import { cookies } from 'next/headers'

import './globals.css'

import { RootProviders } from './providers'
import { NavigationBar } from './components/navigation'
import { getProfile } from './api/fetchers'
import { ACCESS_TOKEN } from './api/constants'
import { LayoutProps } from './types'
import { Profile } from './api/types'

export const metadata = {
  title: 'Next.js',
  description: 'Generated by Next.js',
}

export default async function RootLayout({ children }: LayoutProps) {
  const accessToken = cookies().get(ACCESS_TOKEN)?.value

  let profile: Profile | undefined

  try {
    profile = await getProfile(accessToken)
  } catch {
    profile = undefined
  }

  return (
    <html lang="en">
      <body className="bg-background text-white min-h-screen">
        <RootProviders>
          <NavigationBar profile={profile} />

          <div>{children}</div>
        </RootProviders>
      </body>
    </html>
  )
}
